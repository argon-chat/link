<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Link Telegram</title>
        <script src="https://unpkg.com/@phosphor-icons/web"></script>
        <script
            src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

        <script>
            window.addEventListener("DOMContentLoaded", () => {
                const params = new URLSearchParams(window.location.search);
                const avatarBase64 = params.get("aav");

                const img = document.getElementById("avatar");
                if (avatarBase64) {
                img.src = `https://xcdn.argon.gl/user/${avatarBase64}`;
                } 
            });
        </script>
        <style>
        body {
            background-color: hsl(240 10% 3.9%);
            color: hsl(0 0% 98%);
        }
    </style>
    </head>
    <body class="flex items-center justify-center min-h-screen">
        <div class="flex flex-col items-center gap-6 text-center">
            <div class="flex items-center gap-4 text-4xl text-white/80">
                <img
                    id="avatar"
                    alt="User Avatar"
                    class=" max-w-16 max-h-16 rounded-full object-cover"
                    src="https://xcdn.argon.gl/user/" />
                <i class="ph ph-plus"></i>
                <i class="ph ph-telegram-logo text-blue-400"
                    style="font-size: 64px;"></i>
            </div>
            <div id="telegram-login-button" class="mt-2">
                <script async src="https://telegram.org/js/telegram-widget.js?7"
                    data-telegram-login="argon_chat_link_bot"
                    data-size="large"
                    data-userpic="true"
                    data-radius="8"
                    data-onauth="onTelegramAuth(user)"
                    data-request-access="write">
                </script>
            </div>
        </div>

        <script>
        function onTelegramAuth(user) {
            const params = new URLSearchParams(window.location.search);
            const acv = params.get("acv");

            fetch("https://api.argon.gl/api/link-telegram", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                        telegram: user,
                        acv: acv
                    })
                })
                .then(res => {
                    if (!res.ok) throw new Error("Server error");
                        return res.json();
                })
                .then(data => {
                    console.log("Success:", data);
                })
                .catch(err => {
                    console.error("Error linking Telegram:", err);
            });
        }
        </script>
    </body>
</html>
